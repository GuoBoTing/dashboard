# 🔐 Meta OAuth 登入按鈕使用指南

## ✅ 已完成整合

你的 app.py 現在已經包含完整的 OAuth 登入功能！

## 🎯 如何使用 OAuth 按鈕

### 視覺化流程

```
┌─────────────────────────────────────────────────────┐
│  側邊欄                                              │
│                                                      │
│  ┌────────────────────────────────────────────┐    │
│  │ Meta API 認證                               │    │
│  │                                              │    │
│  │  ○ OAuth 登入 (推薦)  ← 選擇這個              │    │
│  │  ○ Token 管理                                │    │
│  │  ○ 基本模式                                  │    │
│  └────────────────────────────────────────────┘    │
│                                                      │
│  ┌────────────────────────────────────────────┐    │
│  │ 🔐 Meta OAuth 登入                          │    │
│  │                                              │    │
│  │ 登入流程：                                   │    │
│  │ 1. 點擊下方「使用 Meta 登入」按鈕            │    │
│  │ 2. 在 Meta 登入頁面授權應用程式              │    │
│  │ 3. 自動返回並取得長期 Token                 │    │
│  │                                              │    │
│  │ ┌────────────────────────────────────┐      │    │
│  │ │  🔐 使用 Meta 登入                  │      │    │
│  │ └────────────────────────────────────┘      │    │
│  │        ↑ 點擊這個藍色按鈕                    │    │
│  └────────────────────────────────────────────┘    │
│                                                      │
│  (未登入時顯示上方內容)                              │
│                                                      │
└─────────────────────────────────────────────────────┘

點擊按鈕後...

┌─────────────────────────────────────────────────────┐
│  Meta 登入頁面 (facebook.com)                        │
│                                                      │
│  [Meta Logo]                                         │
│                                                      │
│  Flambé Dashboard 想要存取你的：                      │
│  ✓ 基本個人資料                                      │
│  ✓ 廣告帳號資料                                      │
│                                                      │
│  ┌──────────────┐  ┌──────────────┐                │
│  │   取消       │  │   授權       │ ← 點擊授權       │
│  └──────────────┘  └──────────────┘                │
│                                                      │
└─────────────────────────────────────────────────────┘

授權後自動返回...

┌─────────────────────────────────────────────────────┐
│  側邊欄                                              │
│                                                      │
│  ┌────────────────────────────────────────────┐    │
│  │ 🔐 Meta OAuth 登入                          │    │
│  │                                              │    │
│  │ ✅ 已登入: Your Name                        │    │
│  │                                              │    │
│  │ Token 狀態     |  [登出]                    │    │
│  │   有效          |                            │    │
│  │ 有效期: 約 60 天 |                           │    │
│  │                                              │    │
│  └────────────────────────────────────────────┘    │
│                                                      │
│  連接狀態                                            │
│  WooCommerce: 🟢 已連接                             │
│  Meta 廣告: 🟢 已透過 OAuth 認證                    │
│                                                      │
└─────────────────────────────────────────────────────┘

完成！開始使用儀表板 🎉
```

## 📋 啟動前檢查清單

在使用 OAuth 按鈕之前，請確認：

### 1. Meta 開發者平台設定

- [ ] 已登入 https://developers.facebook.com/apps/
- [ ] 選擇你的應用程式（App ID: 2289820758095835）
- [ ] 在「Facebook 登入」→「設定」中
- [ ] 「有效的 OAuth 重新導向 URI」包含：`http://localhost:8501`
- [ ] 已點擊「儲存變更」

### 2. 本地環境設定

- [ ] .env 檔案包含 `META_OAUTH_REDIRECT_URI=http://localhost:8501`
- [ ] .env 檔案包含正確的 `META_APP_ID` 和 `META_APP_SECRET`
- [ ] src/ 目錄下的模組存在且可導入

### 3. 啟動應用

```bash
streamlit run app.py
```

## 🎬 實際操作步驟

### 步驟 1：開啟應用程式

```bash
streamlit run app.py
```

瀏覽器自動開啟 http://localhost:8501

### 步驟 2：選擇 OAuth 登入

在側邊欄：
1. 找到「Meta API 認證」區塊
2. 選擇 **「OAuth 登入 (推薦)」**
3. 頁面會重新載入

### 步驟 3：點擊登入按鈕

1. 向下滾動側邊欄
2. 找到藍色的「🔐 使用 Meta 登入」按鈕
3. 點擊按鈕

### 步驟 4：Meta 授權

1. 自動跳轉到 Meta 登入頁面
2. 使用你的 Facebook 帳號登入（如果尚未登入）
3. 查看應用程式要求的權限
4. 點擊「授權」或「繼續」

### 步驟 5：自動返回

1. 授權後自動返回應用程式
2. 系統自動處理：
   - ✅ 用 code 換取短期 token
   - ✅ 用短期 token 換取長期 token
   - ✅ 驗證 token
   - ✅ 取得使用者資訊
   - ✅ 保存到 session state

### 步驟 6：開始使用

1. 看到「✅ 登入成功！」訊息
2. 側邊欄顯示「Meta 廣告: 🟢 已透過 OAuth 認證」
3. 選擇分析期間
4. 開始查看數據！

## 🔄 OAuth 按鈕的三種狀態

### 狀態 1：未登入

```
┌────────────────────────────────────────┐
│ 🔐 Meta OAuth 登入                     │
│                                         │
│ 透過 Meta OAuth 2.0 登入，自動取得...  │
│                                         │
│ 登入流程：                              │
│ 1. 點擊下方「使用 Meta 登入」按鈕       │
│ 2. 在 Meta 登入頁面授權應用程式         │
│ 3. 自動返回並取得長期 Token            │
│                                         │
│ ┌────────────────────────────────┐    │
│ │  🔐 使用 Meta 登入              │    │
│ └────────────────────────────────┘    │
└────────────────────────────────────────┘
```

### 狀態 2：處理中

```
┌────────────────────────────────────────┐
│ 正在處理授權...                         │
│                                         │
│ ⏳ 步驟 1/3: 換取短期 token...          │
│ ⏳ 步驟 2/3: 換取長期 token...          │
│ ⏳ 步驟 3/3: 驗證 token...              │
└────────────────────────────────────────┘
```

### 狀態 3：已登入

```
┌────────────────────────────────────────┐
│ 🔐 Meta OAuth 登入                     │
│                                         │
│ ✅ 已登入: John Doe                    │
│                                         │
│ Token 狀態        |  [登出]            │
│   有效            |                     │
│ 有效期: 約 60 天  |                     │
│                                         │
│ [查看 Token 資訊]                       │
└────────────────────────────────────────┘
```

## 💡 使用技巧

### 登出並重新登入

1. 在已登入狀態下，點擊「登出」按鈕
2. 頁面重新載入，回到未登入狀態
3. 再次點擊「使用 Meta 登入」按鈕

### 查看 Token 資訊

展開「查看 Token 資訊」可以看到：
- Token 的前 50 個字元（用於驗證）
- 完整的 Token 資訊（用於除錯）

### 切換認證方式

隨時可以切換：
- OAuth 登入 ← 最推薦
- Token 管理
- 基本模式

## 🎉 成功標誌

當 OAuth 登入成功時，你會看到：

1. ✅ 側邊欄顯示「Meta 廣告: 🟢 已透過 OAuth 認證」
2. ✅ 「連接狀態」區塊顯示綠色勾選
3. ✅ 可以選擇日期範圍開始查詢數據
4. ✅ 儀表板正常顯示廣告數據

---

**提示**：如果遇到問題，參考 `QUICK_START.md` 中的故障排除章節！

**建立日期**：2025-09-30
